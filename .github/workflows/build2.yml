name: Build2

on:
  push:
    branches:
      - main
    paths:
      - ".github/workflows/**"
      - "frontend/**"
      - "backend/**"

jobs:
  check:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash {0}
    outputs:
      changes: ${{ steps.filter.outputs.changes }}
      updated: ${{ steps.filter.outputs.changes != '[]' }}
      frontend: ${{ steps.filter.outputs.frontend }}
      backend: ${{ steps.filter.outputs.backend }}
    steps:
      - uses: actions/checkout@v4
      # "Warning: Unexpected input(s) 'predicate-quantifier'"は無視すること
      # https://github.com/dorny/paths-filter/issues/225
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          predicate-quantifier: "every"
          filters: |
            frontend:
              - 'frontend/**'
              - '!frontend/eslint.config.js'
              - '!frontend/docs/**'
              - '!frontend/.*'
            backend:
              - 'backend/**'
      - name: Display outputs
        run: |
          echo "steps.filter.outputs.changes: ${{ steps.filter.outputs.changes }}"
          echo "steps.filter.outputs.updated: ${{ steps.filter.outputs.updated }}"
          echo "steps.filter.outputs.frontend: ${{ steps.filter.outputs.frontend }}"
          echo "steps.filter.outputs.backend: ${{ steps.filter.outputs.backend }}"

  build_frontend:
    runs-on: ubuntu-latest
    needs: check
    if: needs.check.outputs.frontend == 'true'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: cat frontend workspace
        run: |
          cat ./frontend/keep

  build_backend:
    runs-on: ubuntu-latest
    needs: check
    if: needs.check.outputs.backend == 'true'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: cat backend workspace
        run: |
          cat ./backend/keep
